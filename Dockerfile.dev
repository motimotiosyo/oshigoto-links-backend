FROM ruby:3.3.6
WORKDIR /app
RUN apt-get update -y && apt-get install -y --no-install-recommends build-essential postgresql-client libpq-dev curl && rm -rf /var/lib/apt/lists/*
ENV BUNDLE_PATH=/usr/local/bundle BUNDLE_JOBS=4 BUNDLE_RETRY=3 PATH="/usr/local/bundle/bin:${PATH}"
COPY Gemfile Gemfile.lock* ./
RUN bundle install --jobs 4 --retry 3 || true
COPY . .
COPY bin/docker-entrypoint.sh /usr/local/bin/entrypoint.sh
RUN chmod +x /usr/local/bin/entrypoint.sh
EXPOSE 3000
CMD ["/usr/local/bin/entrypoint.sh"]
